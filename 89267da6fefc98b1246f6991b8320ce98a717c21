{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "c743eafb_defa3409",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 23,
      "author": {
        "id": 724
      },
      "writtenOn": "2022-03-08T01:06:22Z",
      "side": 1,
      "message": "Hello Piere, \n\nI have a question regarding this. \n\nHow will pre-flight be executed without podman?\n\nI have some concerns about updating the host CA bundles with certs with the custom CA certificates. Is not possible to pass a temporary trust bundle during the run? or maybe we can try removing them from the system bundle after the test?\n\nThanks!",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8d533ca7_be4afb13",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 23,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-08T01:32:14Z",
      "side": 1,
      "message": "Without podman, the preflight binary  is executed in a temporarily directory.\nUnfortunately it is not possible to pass the CA during the run.\n\nBut yes, I like your idea about deleting the certificate at the end of role. I am preparing a patchset for that.",
      "parentUuid": "c743eafb_defa3409",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c0bd4ebb_1b78949a",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-07T22:06:10Z",
      "side": 1,
      "message": "When you say this CR is to allow preflight to run outside podman you mean that this Root CAs are required to run preflight binary?\n\nI\u0027m a bit hesitant to add CA Roots to the whole system ðŸ˜® I see they are using many (145) root CAs.\n\n  podman run -it --entrypoint cat quay.io/opdev/preflight:1.1.0-alpha2-linux-amd64 /etc/pki/tls/certs/ca-bundle.trust.crt | grep -c -- -B\n  145\n\nDo we need them all? can we extract just the one we really need?",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10e134e3_1d219fd9",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-07T22:16:59Z",
      "side": 1,
      "message": "The preflight_custom_ca is just the CA of the registry not all CA(s).\nWe add only this one on the jumphost.\n\nThe cabundle.stdout is all the CA(s), it used for podman. We are replacing ca-bundle.trust.crt with mount option, so we concatenate the custom CA with the initial file.",
      "parentUuid": "c0bd4ebb_1b78949a",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "83ca4f1d_1f20bfa2",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-08T00:37:31Z",
      "side": 1,
      "message": "Ah! my bad, I thought preflight_custom_ca was the cabundle.\n\nWhere is the preflight_custom_ca defined?\n\n\nWith all that clarified, I believe these two tasks should not be in preflight, but earlier in the agent, perhaps pre-run?, because these changes to the jumphost are global. Preflight is not the only part that talks to the registry, wdyt?",
      "parentUuid": "10e134e3_1d219fd9",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "fccd8694_048706cd",
        "filename": "roles/preflight/tasks/prepare_custom_certificate.yml",
        "patchSetId": 1
      },
      "lineNbr": 26,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-08T01:32:14Z",
      "side": 1,
      "message": "preflight_custom_ca must be define in a setting file.\nIt is undefined by default.\n\nhttps://github.com/redhat-cip/dci-openshift-app-agent/blob/master/roles/preflight/README.md?plain\u003d1#L18\n\nPreflight executes tests of an operator, the first sub-command that preflight executes is `a pull` of the image. The CA certificate is only used at this specific step.\n\nBtw, the best approach for me is to update directly preflight to ignore certificate. And this will be added I think in the future.",
      "parentUuid": "83ca4f1d_1f20bfa2",
      "revId": "89267da6fefc98b1246f6991b8320ce98a717c21",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}