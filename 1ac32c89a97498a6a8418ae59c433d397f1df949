{
  "comments": [
    {
      "key": {
        "uuid": "b526d2b8_a120aca1",
        "filename": "samples/tnf_test_example/hooks/install.yml",
        "patchSetId": 27
      },
      "lineNbr": 31,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-03T19:54:09Z",
      "side": 1,
      "message": "Don\u0027t think we need these in here, because they are defined already in the defaults: https://github.com/redhat-cip/dci-openshift-app-agent/blob/master/roles/cnf-cert/defaults/main.yml#L13-L16\n\nIf they are not defined when the role is called, then those are the values defined and all of them are null already.\n\nIf any other value is defined when calling the role that takes precedence, so I think we are good without them",
      "revId": "1ac32c89a97498a6a8418ae59c433d397f1df949",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d6f6b431_f10bdaae",
        "filename": "samples/tnf_test_example/hooks/install.yml",
        "patchSetId": 27
      },
      "lineNbr": 31,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-06T10:08:29Z",
      "side": 1,
      "message": "But this is what I was commenting on my previous comment, here: https://softwarefactory-project.io/r/c/dci-openshift-app-agent/+/22351/26/samples/tnf_test_example/hooks/templates/test_deployment.yml.j2#17. I will summarize that comment below.\n\nThe thing is, the default value for these three variables are defined in roles/cnf-cert (because they are needed to build the templates provided in the cnf-cert role), and this role is out of the secope of samples/tnf_test_example_hooks, because the hooks are directly called from the main d-o-a-a playbook (dci-openshift-app-agent.yml). So, as I said, if I don\u0027t include any of these variables in the pipeline I am using to call the d-o-a-a or as an Ansible extravar if calling directly the d-o-a-a, it fails because Ansible detects these variables are not defined. That\u0027s why I have included these three definitions, which it is also done in hooks/pre-run.yml with the variable called dci_openshift_app_ns.\n\nAnd what I was wondering is if it is a better way of doing this, e.g. importing the values from roles/cnf-cert/defaults/main.yml into samples/tnf_test_example/hooks but not overwritting the values provided as extravars from outside. Or, otherwise, if I can leave these definitions as they are now.",
      "parentUuid": "b526d2b8_a120aca1",
      "revId": "1ac32c89a97498a6a8418ae59c433d397f1df949",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "179e2da0_1d01edfd",
        "filename": "samples/tnf_test_example/hooks/install.yml",
        "patchSetId": 27
      },
      "lineNbr": 31,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-07T14:03:21Z",
      "side": 1,
      "message": "Ah! thanks for the clarification, I completely missed your first comment, my bad.\n\nLet me then take a different view then. When this template is rendered there are two options for any of these four variables, either they are defined or not. Only when is defined you want to distinguish between null, empty and non-empty values, right?\n\nIf I\u0027m not missing anything, then you could replace the above with a conditional in the template like this:\n\nif tnf_targetpodlabels_name is defined and if tnf_targetpodlabels_name is not none and tnf_targetpodlabels_name|length\n\nI know is really long!! ðŸ˜®\n\nBut I was thinking you could reduce it a bit by passing vars into the task below like this:\n\nk8s:\nvars:\n  tnf_targetpodlabels_name: \"{{ tnf_targetpodlabels_name|default(\u0027\u0027) }}\"\n\nThat way inside the template you only check for length like this\n\nif tnf_targetpodlabels_name|length\n\nWhat do you think of this approach? it should make it easier to understand and to read",
      "parentUuid": "d6f6b431_f10bdaae",
      "revId": "1ac32c89a97498a6a8418ae59c433d397f1df949",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02a89c16_359a627a",
        "filename": "samples/tnf_test_example/hooks/install.yml",
        "patchSetId": 27
      },
      "lineNbr": 31,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-07T15:40:11Z",
      "side": 1,
      "message": "it is a good solution, thanks Tony!! \nBut just only one modification included from my side: if the same variable name is used, when templating, it happens a \"recursive loop\" error like this: https://github.com/ansible/ansible/issues/58952\nI just renamed the variable used to avoid this, e.g.:\ntargetpodlabels_name: \"{{ tnf_targetpodlabels_name|default(\u0027\u0027) }}\"\n(just remove tnf_ in the variable name)",
      "parentUuid": "179e2da0_1d01edfd",
      "revId": "1ac32c89a97498a6a8418ae59c433d397f1df949",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    }
  ]
}