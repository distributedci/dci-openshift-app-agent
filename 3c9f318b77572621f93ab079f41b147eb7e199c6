{
  "comments": [
    {
      "key": {
        "uuid": "dc417492_bc91477b",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 38,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "Could simplify a bit this with:\ngrep -c targetPodLabels {{ tnf_git_dir }}/test_network_function/test-network-function/tnf_config.yml",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3cea6693_1d57273d",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 38,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "done, thanks! as this command is also executed even when the tnf_config.yml is not present (because other version of the CNF Cert Suite may be used instead), I have included a when clause to only do this when the tnf_config.yml file is present in the CNF Cert Suite repo. In case it is not present, the default value of autodiscovering_enabled, created in defaults/main.yml, is used.\nAnd also, I need to include a ignore_errors: true clause because that command fails when targetPodLabels is not found.",
      "parentUuid": "dc417492_bc91477b",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4c099eb6_80268e54",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 62,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "Is there any value in attempting to run the tests in the container? I know that it was not an option as the TNF code didn\u0027t seem to be working back then, but not sure if with newer versions that has been improved.\nI see that running tests in a container could potentially reduce the maintenance as currently we have to build and satisfy its deps.",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4454b854_20a21fff",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 62,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "I don\u0027t really know if the usage of containers instead of the binary would provide more value to us. \nAt least for v1.0.8, the use of containers was not working in our d-o-a-a, that\u0027s why the code was commented and, now, removed. Honestly, I have not tested the container solution since then, but I think it has included changes in the way it is working, at least for v3.0.0.\nFor the moment, at least with the three CNF Cert Suite versions I have tested  (v1.0.8, v2.0.0 and v3.0.0), the way of building and executing the binary has not changed (only to provide the -f argument in v3.0.0, but this also happens with the containerized solution), and it is working fine for all the versions without needing a lot of changes.\nI can add the re-evaluation of the usage of the containerized test suite as a new task to be reviewed, if you find it okey, checking also the impact of moving to the container rather than using the binary.",
      "parentUuid": "4c099eb6_80268e54",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "67531303_045156a3",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 71,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "Would it be possible to move the two env vars in this conditional to the other conditional of autodiscovering_enabled when is not 0 in line 78? I think those vars are used when running the tests, if possible then it reduces one conditional and makes it easier to read",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "8902fb13_19ea0f2f",
        "filename": "roles/cnf-cert/tasks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 71,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "yes, sure, done!",
      "parentUuid": "67531303_045156a3",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f49c8cb9_d0e64f4a",
        "filename": "roles/cnf-cert/templates/generic_test_configuration.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 42,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "I see default value of tnf_exclude_connectivity_regexp is null, shouldn\u0027t the previous validation be kept to avoid passing a null to regex_search ?",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "283cfda0_211300bc",
        "filename": "roles/cnf-cert/templates/generic_test_configuration.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 42,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "I totally forgot that the default value was null, because I always looked at the pipelines and there, the value used is the empty string, thanks Tony.\n\nHowever, should the validation be the following instead?\n\n{% if tnf_exclude_connectivity_regexp is defined and tnf_exclude_connectivity_regexp !\u003d \"\" and ( pod.metadata.name | regex_search(tnf_exclude_connectivity_regexp) ) %}\n\nI mean, first of all, we need to check if tnf_exclude_connectivity_regexp is defined and not the empty string (this second one is just in case, because I experienced problems with this with some manual tests I did), and if true, check if the regex passes. In the previous code:\n\n{% if not tnf_exclude_connectivity_regexp or ( pod.metadata.name | regex_search(tnf_exclude_connectivity_regexp) ) %}\n\nIt is like, AFAIK, the validation passes if the variable is not defined OR the regex passes. So, if the variable is null, the validation passes? That\u0027s why I eventually changed it.",
      "parentUuid": "f49c8cb9_d0e64f4a",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "af0b4433_9b1a5dc9",
        "filename": "roles/cnf-cert/templates/tnf_config.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 28,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "similar comment, not sure if tnf_exclude_connectivity_regexp may fail as it\u0027s default value is null",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "95c21336_c3cf2780",
        "filename": "roles/cnf-cert/templates/tnf_config.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 28,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "yes, doing the same than in the other comment",
      "parentUuid": "af0b4433_9b1a5dc9",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b16da307_0997af98",
        "filename": "roles/cnf-cert/templates/tnf_config.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 141,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "ditto",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "4035b699_8dc89e78",
        "filename": "roles/cnf-cert/templates/tnf_config.yml.j2",
        "patchSetId": 25
      },
      "lineNbr": 141,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "same as before",
      "parentUuid": "b16da307_0997af98",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "64466119_abd7290d",
        "filename": "samples/tnf_test_example/hooks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 12,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "Let\u0027s trim that space at the end",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d9737483_5b71f85b",
        "filename": "samples/tnf_test_example/hooks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 12,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "done, although with the other change to reduce multiple tasks with a single one, this will be removed.",
      "parentUuid": "64466119_abd7290d",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "57b849d1_46415f40",
        "filename": "samples/tnf_test_example/hooks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 18,
      "author": {
        "id": 667
      },
      "writtenOn": "2021-09-01T22:49:39Z",
      "side": 1,
      "message": "I think you could reduce multiple tasks with a single one using k8s_info, something like:\n\n- name: Checking test pods are running\n  k8s_info:\n    namespace: \"{{ dci_openshift_apps_ns }}\"\n    kind: Pod\n    label_selectors:\n      - test-network-function.com/generic\u003dtarget\n  register: test_result\n  retries: 60\n  delay: 5\n  until:\n    - \"test_result.resources|length \u003e 1\"\n    - \"\u0027status\u0027 in test_result.resources[0]\"\n    - \"\u0027phase\u0027 in test_result.resources[0].status\"\n    - \"test_result.resources[0].status.phase \u003d\u003d \u0027Running\u0027\"\n\nThe above is an example by checking only one pod but it may be possible to check that all the expected nodes are running, at least is the idea ðŸ˜„",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d3fbb00d_ec636512",
        "filename": "samples/tnf_test_example/hooks/tests.yml",
        "patchSetId": 25
      },
      "lineNbr": 18,
      "author": {
        "id": 800
      },
      "writtenOn": "2021-09-02T12:08:57Z",
      "side": 1,
      "message": "wow, it is a nice checkchange, thanks Tony!! Applied in the code ðŸ˜Š",
      "parentUuid": "57b849d1_46415f40",
      "revId": "3c9f318b77572621f93ab079f41b147eb7e199c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0",
      "unresolved": false
    }
  ]
}