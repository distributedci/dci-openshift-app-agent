# OPCAP tool role

OPCAP is a tool to test the installation of the Openshift operator.
Here is the official [Github repository](https://github.com/opdev/opcap) of the tool for more details.

This role clones the official repository, builds the tool and launches checks on a catalog operator.
It generates a JSON file with the results of the checks and it also display all the packages available in the catalog
in the Ansible playbook.

## Usage

Name                               | Default                         | Description
---------------------------------- |---------------------------------| -------------------------------------------------------------
target_catalog_source              | None                            | (Mandatory) Name of the catalogSource that will be checked
catalog_source_namespace           | None                            | (Mandatory) Namespace where is deployed the catalogSource tested
opcap_dir                          | autogenerated directory         | Directory where the opcap tool is built. It is removed at the teardown step.
opcap_repo                         | https://github.com/opdev/opcap  | Repository used to clone and build the tool
audit_plan                         | "OperatorInstall,OperandInstall" | In order to test operands, audit plan can be modify. Posiible values: "OperatorInstall,OperandInstall,OperandCleanUp,OperatorCleanUp" 

### Example

KUBECONFIG must be defined as a ENV variable in order to have opcap bin working properly:

    - name: Run opcap checks on my-catalog
      include_role:
        name: opcap-tool
        apply:
          environment:
            - KUBECONFIG: "{{ kubeconfig_path }}"
      vars:
        target_catalog_source: "my-catalog"
        catalog_source_namespace: "openshift-marketplace"
