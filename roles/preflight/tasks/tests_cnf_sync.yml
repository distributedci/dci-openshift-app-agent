---

# WIP.

- name: Define preflight_operators_to_check if not present
  set_fact:
    preflight_operators_to_check: []
  when: preflight_operators_to_check is not defined

# Currently using an already generated claim.json file
# TODO. To be changed to retrieve the claim.json file generated by tnf
- name: Parse claim.json
  vars:
    cnf_operators_file: "{{ lookup('file', 'files/claim.json') | from_json }}"
  set_fact:
    cnf_operators: "{{ cnf_operators_file | json_query('claim.configurations.testTarget.operators') }}"

- name: Build operators for Preflight cert suite
  set_fact:
    preflight_operators_to_check: "{{
      preflight_operators_to_check +
      [ { 'name'         : item.name.split('.')[0],
          'version'      : item.Version,
          'bundle_image' : item.bundleImage,
          'index_image'  : item.indexImage } ]
    }}"
  loop: "{{ cnf_operators }}"
...
