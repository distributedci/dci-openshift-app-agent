---
- name: "Install required rpm packages"
  package:
    name: "{{ item }}"
    state: present
  loop:
    - curl
    - python3-openshift
    - python3-pyyaml
  become: true

- name: "Configure the namespace variable"
  set_fact:
    app_ns: "{{ dci_openshift_app_ns|default('myns') }}"

- name: DEBUG
  debug:
    msg: "local_registry_host is {{ local_registry_host }}, local_registry_port is {{ local_registry_port }}, dci_disconnected is {{ dci_disconnected }}, provisionhost_registry is {{ provisionhost_registry }}, all_registries_creds is {{ all_registries_creds }}"

- name: Copy nginx image
  shell: |
    set -ex
    skopeo copy --authfile {{ all_registries_creds }} --remove-signatures \
    docker://docker.io/library/nginx \
    docker://{{ provisionhost_registry }}/library/nginx
  when:
    - dci_disconnected | default(false) | bool
    - provisionhost_registry|length
    - all_registries_creds|length
