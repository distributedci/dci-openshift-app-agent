---
- name: Retrieve pullsecret's content
  slurp:
    src: "{{ partner_creds }}"
  register: pullsecret_content
  no_log: true

- name: Create a secret for the pod
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Secret
      metadata:
        name: basic-example-secret
        namespace: "{{ app_ns }}"
      type: kubernetes.io/dockerconfigjson
      data:
        .dockerconfigjson: "{{ pullsecret_content.content }}"

- name: Create a simple pod
  community.kubernetes.k8s:
    state: present
    definition:
      apiVersion: v1
      kind: Pod
      metadata:
        app: httpd
        name: webserver
        namespace: "{{ app_ns }}"
      spec:
        containers:
          - name: webserver
            image: "{{ dci_openshift_app_image | default('docker.io/library/nginx') }}"
            securityContext:
              capabilities: {}
            ports:
              - containerPort: 80
            livenessProbe:
              failureThreshold: 3
              httpGet:
                path: /
                port: 80
              scheme: HTTP
            initialDelaySeconds: 30
            periodSeconds: 30
            successThreshold: 1
        imagePullSecrets:
          - name: basic-example-secret
    wait: true
...
