---
- name: Create namespace
  k8s:
    api_version: v1
    kind: Namespace
    name: "{{ dci_openshift_app_ns }}"
    state: present

- name: Check if test pods exist
  k8s_info:
    api_version: v1
    kind: Pod
    namespace: "{{ dci_openshift_app_ns }}"
    label_selectors:
      - test-network-function.com/generic = target
  register: test_pods

- name: Set tnf_targetpodlabels_name if not defined
  set_fact:
    tnf_targetpodlabels_name: null
  when: tnf_targetpodlabels_name is not defined

- name: Set tnf_targetpodlabels_value if not defined
  set_fact:
    tnf_targetpodlabels_value: null
  when: tnf_targetpodlabels_value is not defined

- name: Set tnf_exclude_connectivity_regexp if not defined
  set_fact:
    tnf_exclude_connectivity_regexp: null
  when: tnf_exclude_connectivity_regexp is not defined

- name: Create a Deployment with 2 replicas of the testing pod
  k8s:
    state: present
    definition: "{{ lookup('template', 'templates/test_deployment.yml.j2') | from_yaml }}"
  when: test_pods.resources|length == 0
