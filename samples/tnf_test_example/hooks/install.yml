---

# if the namespace is dci_openshift_app_ns,
# its creation is handled in d-o-a-a plays, so
# we do not need to do that here
- name: Create namespaces if not done before
  include_tasks: create_namespaces.yml
  vars:
    app_ns: "{{ pods_in_same_ns.namespace }}"
  when: 
    - pods_in_same_ns.namespace is defined
    - pods_in_same_ns.namespace|length
    - pods_in_same_ns.namespace != dci_openshift_app_ns
  loop: "{{ tnf_config|default([]) }}"
  loop_control:
    loop_var: pods_in_same_ns

# exclude_connectivity_regexp is not checked because it is optional
- name: Create test pods on each namespace if not done before
  include_tasks: create_test_pods.yml
  vars:
    app_ns: "{{ pods_in_same_ns.namespace }}"
    targetpodlabels: "{{ pods_in_same_ns.targetpodlabels }}"
    exclude_connectivity_regexp: "{{ pods_in_same_ns.exclude_connectivity_regexp|default('') }}"
  when: 
    - pods_in_same_ns.namespace is defined
    - pods_in_same_ns.namespace|length
    - pods_in_same_ns.targetpodlabels is defined
    - pods_in_same_ns.targetpodlabels is iterable
  loop: "{{ tnf_config|default([]) }}"
  loop_control:
    loop_var: pods_in_same_ns
