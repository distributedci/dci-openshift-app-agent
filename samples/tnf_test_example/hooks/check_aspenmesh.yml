---
- name: Check if istio-system namespace exists
  community.kubernetes.k8s_info:
    api_version: v1
    kind: Namespace
    name: istio-system
  register: istio_system_namespace

- name: Check Aspenmesh Helm charts
  community.kubernetes.helm_info:
    name: "{{ am_chart }}"
    release_namespace: "{{ (am_chart == 'istio-cni') | ternary('kube-system', 'istio-system') }}"
  loop:
    - "istio-cni"
    - "istio-egress"
    - "istio-ingress"
    - "istio-init"
    - "istiod"
  loop_control:
    loop_var: am_chart
  when: istio_system_namespace.resources|length > 0
  register: am_chart_check
