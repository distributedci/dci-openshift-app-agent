---
# if the namespace is dci_openshift_app_ns,
# its deletion is handled in d-o-a-a plays, so
# we do not need to do that here
- name: Delete namespaces if not done before
  community.kubernetes.k8s:
    api_version: v1
    kind: Namespace
    name: "{{ item.namespace }}"
    state: absent
  when:
    - tnf_config is defined
    - tnf_config|length
    - item.namespace is defined
    - item.namespace|length
    - item.namespace != dci_openshift_app_ns
  loop: "{{ tnf_config }}"

- name: Delete anyuid Cluster Role Binding setting sidecar security policy
  community.kubernetes.k8s:
    api_version: rbac.authorization.k8s.io/v1
    kind: ClusterRoleBinding
    name: "{{ item.namespace }}:scc:anyuid"
    state: absent
  when:
    - am_installed | default(false) | bool
    - tnf_config is defined
    - tnf_config|length
    - item.namespace is defined
    - item.namespace|length
  loop: "{{ tnf_config }}"

- name: Delete simple-demo-operator-catalog
  community.kubernetes.k8s:
    state: absent
    api_version: operators.coreos.com/v1alpha1
    name: "{{ tnf_operator_to_install.operator_name | default('simple-demo-operator') }}-catalog"
    namespace: openshift-marketplace
    kind: CatalogSource
