---
- name: "Remove the webserver helm chart"
  community.kubernetes.helm:
    name: "webserver"
    release_namespace: "{{ openshift_app_ns }}"
    binary_path: "{{ helm_tool_path }}"
    release_state: absent
    wait: true
  when:
    - openshift_app_helm_chart is defined
    - openshift_app_helm_chart | length > 0

- name: "Delete tmp tools directory"
  file:
    path: "{{ helm_tmp_dir.path }}"
    state: absent
  when:
    - helm_tmp_dir is defined
    - helm_tmp_dir.path is defined

- name: Delete the load test container
  when: openshift_app_test_stage | default('') == "post-upgrade"
  block:
    - name: Get the configmap with the container info
      community.kubernetes.k8s_info:
        kind: ConfigMap
        namespace: "{{ openshift_app_ns }}"
        name: load-test-container
      register: container_info

    - name: Delete load test container
      containers.podman.podman_container:
        name: "{{ container_info.resources[0].data.containerName }}"
        state: absent
