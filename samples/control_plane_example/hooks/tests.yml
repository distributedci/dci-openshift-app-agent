---
- name:  Wait until pod livenessProbe starts
  pause:
    seconds: 40

- name: Search for all running pods
  kubernetes.core.k8s_info:
    namespace: "{{ openshift_app_ns }}"
    kind: Pod
    name: webserver
    field_selectors:
      - status.phase=Running
  register: web_service

- name: Fail if pod is NOT found
  fail:
    msg: "webserver is not running"
  when: web_service == False

- name: Trying to attach ocp component to the job
  dci_job_component:
    job_id: "{{ job_info.job.id }}"
    component_id: "{{ ocp_component_id }}"
  register: job_component_result
  until: job_component_result is not failed
  retries: 5
  delay: 20


