{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ff9fccdf_d8be8f1b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-03-10T13:59:11Z",
      "side": 1,
      "message": "The changes looks OK to me.\nMy only comment, if any, would be that this action of creating the cache directory is done the same way in different points of the two agents so this is a good example of code we should try to reuse.\nI\u0027ll be happy to vote for this change when the issue with the ci bot is solved.",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ebe0cb96_02813da0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2022-03-10T15:12:48Z",
      "side": 1,
      "message": "Hi Manuel, I run a quick test in Dallas to verify that this change would work when d-o-a-a in isolated mode, on the top of the already installed cluster: https://www.distributed-ci.io/jobs/9e249f04-5150-476e-b3b2-00b0db3df98a/jobStates",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "84aad3b8_e9572752",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-09T23:16:33Z",
      "side": 1,
      "message": "I think the ansible_user of doaa is kni. Not sure if it is what we want.",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3de3b6b4_5da644e0",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 789
      },
      "writtenOn": "2022-03-10T13:59:11Z",
      "side": 1,
      "message": "If I\u0027m not mistaken, all connections on the provision host are done either with user kni or dci (se below an example from intel\u0027s provisioner) so, unless I\u0027m missing a point, we should be safe here:\n\n# ls -lh /opt/cache/\ntotal 2.7G\ndrwxrwxr-x. 2 dci  dci   135 Feb 19 20:04 4.10.0-rc.3\ndrwxrwxr-x. 2 dci  dci  4.0K Feb 24 06:39 4.10.0-rc.4\ndrwxrwxr-x. 2 dci  dci   141 Feb 28 04:36 4.10.0-rc.5\ndrwxrwxr-x. 2 dci  dci   135 Jan 17 07:31 4.8.23\ndrwxrwxr-x. 2 dci  dci   151 Dec 22 12:06 4.8.24",
      "parentUuid": "84aad3b8_e9572752",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "142698f2_cf0b09eb",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-10T14:34:08Z",
      "side": 1,
      "message": "In intel, these directories is created by doa not doaa :)\n\nI ran a quick test with doaa-ctl\nhttps://www.distributed-ci.io/jobs/149dceac-6f93-46ce-a75d-a9ca4d7e0ffd/jobStates#ddf19175-b630-4e08-8591-f942e53d162f:file4\n\nAlso when it executed with a pipeline, the results seems different",
      "parentUuid": "3de3b6b4_5da644e0",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9899caeb_81d8cf25",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 908
      },
      "writtenOn": "2022-03-10T14:54:59Z",
      "side": 1,
      "message": "I see each partner does it differently, Casa uses d-o-a and Mavenir use d-o-o-a user to run the agent. We in Dallas use dciteam :P, should we create the dir with a particular user that we know is present in all deployments (becoming sudo)? this will impact the uncompress tasks too, and maybe others. And in Dallas /opt/cache is used by d-o-a too, but d-o-a does not create it, SNO uses it too, and sets the ansible-user. So I wonder if we should use a diff path for d-o-a-a. I\u0027ll think about this, but any opinions are welcome.",
      "parentUuid": "142698f2_cf0b09eb",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2d6080b4_ccbb0cb4",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-10T15:09:46Z",
      "side": 1,
      "message": "ansible_user (with doaa-ctl) is not taken the user used to executed the command but the remote_user defined in /usr/share/dci-openshift-app-agent/ansible.cfg\nWhich is by default kni.",
      "parentUuid": "9899caeb_81d8cf25",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d321f1ea_1db57b94",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 908
      },
      "writtenOn": "2022-03-10T15:32:20Z",
      "side": 1,
      "message": "Pierre, thanks for clarifying this, but unless I\u0027m missing something, I ran, doaa-ctl as d-o-a user and the /opt/cache dir was created as d-o-a user: \n\n[dci-openshift-agent@pctt-hv5 ~]$ dci-openshift-app-agent-ctl -s -- -v\n[dci-openshift-agent@pctt-hv5 ~]$ ls -ld /opt/cache\ndrwxr-xr-x. 3 dci-openshift-agent dci-openshift-agent 20 Mar  9 22:24 /opt/cache\n\nI do not have kni user at all\n[dci-openshift-agent@pctt-hv5 ~]$ id kni\nid: ‚Äòkni‚Äô: no such user",
      "parentUuid": "2d6080b4_ccbb0cb4",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "24c89ba7_b5a87713",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-10T16:05:38Z",
      "side": 1,
      "message": "I did another test üòä\nhttps://www.distributed-ci.io/jobs/378b87dd-c072-4a40-bb20-95723fe9f75e/jobStates#ce0f4510-66b6-4df1-b54f-d51c07d893c6:file4\n\nansible_user is kni, but ansible_user_id is dci-openshift-agent üëç\nGood to know! We just have to validate that we have the same values when we run with pipeline :) The last success skipped the task.",
      "parentUuid": "d321f1ea_1db57b94",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b740d583_e168da46",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 908
      },
      "writtenOn": "2022-03-10T16:19:48Z",
      "side": 1,
      "message": "Yes, I saw in Tatiana\u0027s test that dir creation/modification is skipped because d-o-a-a checks if the OC tools are cached, then is not going to create /opt/cache and pull the client. https://www.distributed-ci.io/jobs/9e249f04-5150-476e-b3b2-00b0db3df98a/jobStates#2dd1e14b-6a52-4f7e-aacb-80053d9e7a43:file25\nAnd assuming the OC tools are not cached, then at that moment /opt/cache will be checked and ownership will set to the ansible_user_id, which is Dallas is dciteam, and /opt/cache is already owned by dciteam. In Dallas we tested with the tnf-test-cnf pipeline, and Tatiana did it with example-cnf, I\u0027ll delete the OC tools from the cache dir to see this patch in action.",
      "parentUuid": "24c89ba7_b5a87713",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1c89750c_82802be2",
        "filename": "plays/check_kubeconfig.yml",
        "patchSetId": 1
      },
      "lineNbr": 154,
      "author": {
        "id": 821
      },
      "writtenOn": "2022-03-10T16:21:50Z",
      "side": 1,
      "message": "Good, I tested in my environment with dci-agent-ctl it works well.\nhttps://www.distributed-ci.io/jobs/80519f36-a91e-4b2f-90a8-7c075e55db54/jobStates#652b3ccb-f26a-4cc4-a2fc-4e6f52d0ccfe:file4",
      "parentUuid": "24c89ba7_b5a87713",
      "revId": "f9202e669a0e0b27285ebc69b28e03a1ff376eda",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}