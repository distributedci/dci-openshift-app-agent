{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "115dc4f5_22969e98",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-01-24T16:27:06Z",
      "side": 1,
      "message": "I\u0027m curious on the reason the wait options might not be working as expected",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c48013c9_94f238ff",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 800
      },
      "writtenOn": "2023-01-24T17:00:47Z",
      "side": 1,
      "message": "Fixed, I needed to change volume.resources -\u003e volume.result :)",
      "parentUuid": "115dc4f5_22969e98",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "184c3ba7_2062de86",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-01-24T17:41:12Z",
      "side": 1,
      "message": "The question is more why this change is needed and why native wait setting in the module is not working as expected.",
      "parentUuid": "c48013c9_94f238ff",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8e2b861b_1a10d76d",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 800
      },
      "writtenOn": "2023-01-25T17:41:17Z",
      "side": 1,
      "message": "I commented about this in CILAB-957. In some DCI jobs like this one: https://www.distributed-ci.io/jobs/70781364-5c84-444a-8ba7-655ab621cb38/jobStates?sort\u003ddate\u0026task\u003db1803192-4e04-435b-8e40-fd934f3bd4af, if you check the output of the current task that performs the removal of PVs, you\u0027ll see the following error message: `\"status\": {\"message\": \"error getting deleter volume plugin for volume \\\"volume-production-cnf-test-1\\\": no deletable volume plugin matched\", \"phase\": \"Failed\"}`.\n\nSo, despite passing the task, the PV is not deleted, in fact. And when running a new job, it is still there and it causes issues when creating it.\n\nThat\u0027s why the job fails and that\u0027s why we want to do the cleanup in the pre-run and doing the removal of PVs in a different way.\n\nOf course, if you think there\u0027s a better way of doing this, I can change that!",
      "parentUuid": "184c3ba7_2062de86",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44a05e75_31bf534d",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-01-25T21:03:02Z",
      "side": 1,
      "message": "Thanks for bringing the context to this conversation. Did you see there\u0027s a difference between the first and the 2nd item of the task? The first one was completed successfully and is giving you the expected status, the 2nd one is failing.\nBy any chance, did you try to set a the status[0] in the wait_condition to match the deleted PV in that example? Maybe this is the way to guarantee that the PV is completely deleted.\n\n[0] https://docs.ansible.com/ansible/2.10/collections/community/kubernetes/k8s_module.html#parameter-wait_condition/status",
      "parentUuid": "8e2b861b_1a10d76d",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d7c54c56_ba001ed2",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 800
      },
      "writtenOn": "2023-01-26T11:50:34Z",
      "side": 1,
      "message": "That\u0027s a good proposal, let me do the change and recheck with some options!",
      "parentUuid": "44a05e75_31bf534d",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7178692_b16d8c75",
        "filename": "samples/tnf_test_example/hooks/delete_local_volumes.yml",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 800
      },
      "writtenOn": "2023-01-26T13:03:11Z",
      "side": 1,
      "message": "Tony, I\u0027ve tried with this and I think that the \"Failed\" status is not an error, it is just that Ansible did the check when the PV was already removed and then it printed Failed because it was not there. I was able to reproduce this in this job [0], and I could see that, despite the task shows \"Failed\" status, it was because the PVs were deleted correctly.\n\nSo I\u0027ll use the current way of deleting the PVs finally, only including the cleanup tasks in the pre-run and that\u0027s all.\n\n[0] https://www.distributed-ci.io/jobs/6ceefb9b-6d16-4937-a412-b4c1b535e73c/jobStates",
      "parentUuid": "d7c54c56_ba001ed2",
      "revId": "6b1fa489367d57bf94089db628f9a416075ab503",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}