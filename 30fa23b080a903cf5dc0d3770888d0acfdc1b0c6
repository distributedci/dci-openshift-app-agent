{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "b478a9b2_a9cb6d1c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 5
      },
      "lineNbr": 0,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-08T18:02:33Z",
      "side": 1,
      "message": "LGTM, let\u0027s make sure it\u0027s tested in both cases",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c423dc00_5499b92a",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 606
      },
      "writtenOn": "2022-03-08T18:31:16Z",
      "side": 1,
      "message": "This is fine, but I just want to point out that you don\u0027t need the or statements..\n\nIf job_info is undefined then everything else will be undefined as well.",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a03d7145_ca56623e",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-08T20:19:01Z",
      "side": 1,
      "message": "I think the problem that Ram√≥n is trying to solve is when job_info is defined but id is missing\n\nNot sure when this case could occur, but looking at the docs[1] it seems like we have the id at a different level and not under job_info_.job. Please correct me if I\u0027m wrong here\n\n[1] https://github.com/redhat-cip/dci-openshift-app-agent/blob/master/README.md?plain\u003d1#L224-L229",
      "parentUuid": "c423dc00_5499b92a",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3da5a85e_cbf7fff6",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 606
      },
      "writtenOn": "2022-03-08T20:32:08Z",
      "side": 1,
      "message": "forehead smack.  Yes.  I lost the forest from the tress.\n\nBut I think the or may cause problems..  I think even if job_info is undefined it will still try and see if job_info.job is undefined, etc..  which I think will throw an error.\n\nwhen:\n - job_info is undefined\n - job_info.job is undefined\n - job_info.job.id is undefined\n\nI believe it will stop checkinhg at the first one that is undefined which I believe is what we want.\n\nOr am I missing something?",
      "parentUuid": "a03d7145_ca56623e",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2acc3182_8b45b037",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-08T20:57:31Z",
      "side": 1,
      "message": "You\u0027re right, this is what we need :)",
      "parentUuid": "3da5a85e_cbf7fff6",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "482fd53e_19a04bc1",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 800
      },
      "writtenOn": "2022-03-09T12:28:03Z",
      "side": 1,
      "message": "Mmmm I\u0027ve been doing local tests and, by using AND instead of OR, we will not have the desired behavior. We obtained it with OR, in fact.\n\nI\u0027ve gathered all the tests in this Gist: https://gist.github.com/ramperher/53198407de65c5c2b0fc8591eafae1fa\n\nIf you take a look to the code, as Tony said, what we want to do is to execute \"Fail properly\" without using the DCI job ID when:\n- we have an error that happens before creating the job_info variable (which happened in the past and that\u0027s why we currently have two tasks for handling the error)\n- we don\u0027t have a DCI job ID because we are skipping [dci] tag when we run d-o-a-a\n\nSo, in the first case, it is clear that job_info, job_info.job and job_info.job.id are undefined, so both AND and OR checks will offer the same result. However, in the second case, it may happen that job_info is defined in the settings, as commented by Jennifer Chen in Distributed CI google channel last Monday:\n\n\"Thanks for the info. If there is a way I can use this feature for now with\n```\n[dci-openshift-app-agent@infra4 hooks]$ cat /etc/dci-openshift-app-agent/no-dci.yml\njob_id: fake-id\njob_info:\n  job:\n    components:\n    - name: 1.3.9\n      type: my-component\n```\n\"\n\nAnd in that eventual case, job_info and job_info.job are defined, but job_info.job.id is not defined.\n\nIf that work was made in order to pass the condition on the d-o-a-a job (so, we will never have the case of job_info defined but id undefined), then yes, we can go on with the AND approach, but if not, it\u0027s better to leave the OR there.\n\nAnd of course, if we allow that behavior, we also need to do the same check for the failure message (below), as proposed in the change.\n\nBy the way, with the shared gist, you\u0027ll have all the tests that check that this workflow works, just in case we decide on leaving OR - so we don\u0027t need to test nothing more, I guess, because it\u0027s a feature which is hard to test",
      "parentUuid": "2acc3182_8b45b037",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "44eaea92_ae2bee9a",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 606
      },
      "writtenOn": "2022-03-09T13:25:41Z",
      "side": 1,
      "message": "My apologies Ramon.  Sorry for the extra back and forth but I do appreciate both of you working through the issue and making sure the logic is sound.  It always confuses me when negating the logic you need to switch from AND to OR.  I guess I was still thinking is defined instead of is undefined.  Thanks again.",
      "parentUuid": "482fd53e_19a04bc1",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c70453d3_d691b6af",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 667
      },
      "writtenOn": "2022-03-09T22:54:49Z",
      "side": 1,
      "message": "My bad, I also got confused.\n\nI\u0027d think we will need to update the docs as well to avoid this issue in the first place, but if someone does not have the proper job related keys then this will fail safely",
      "parentUuid": "44eaea92_ae2bee9a",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f143c02c_73994d96",
        "filename": "dci-openshift-app-agent.yml",
        "patchSetId": 5
      },
      "lineNbr": 43,
      "author": {
        "id": 800
      },
      "writtenOn": "2022-03-10T10:05:24Z",
      "side": 1,
      "message": "I have finally found why it is defined job_info in the settings when we skip dci tag, and it is because of this subchapter of the README: https://github.com/redhat-cip/dci-openshift-app-agent#using-customized-tags\n\nHowever, I fear this comment is outdated, because it was included the 5th May 2021, almost 1 year ago, and d-o-a-a has changed a lot since that date.\n\nSo, let me propose something:\n\n- I will simplify the first check, only putting that `job_info is not defined`, as it was previously\n- I will leave the second check as it is, with the dci tag, then it would not be run if dci tag is skipped\n- I will change the README to remove the references about defining job_info variable if dci tag is skipped.\n\nThat would clarify (and simplify) everything, I think.\n\nI\u0027ve run a test skipping dci tag and it passed (you can see it above this comment, but you will not see anything on DCI as the tasks related to dci were skipped), so it seems it\u0027s not a problem not to define job_info.\n\nDo you think it is fine?\n\nI\u0027ll add @Fred too because he was the one who put the comment in the README one year ago, to confirm it\u0027s fine.",
      "parentUuid": "c70453d3_d691b6af",
      "revId": "30fa23b080a903cf5dc0d3770888d0acfdc1b0c6",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}