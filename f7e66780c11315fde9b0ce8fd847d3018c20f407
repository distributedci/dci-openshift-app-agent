{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "97d7aa4d_18790c64",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-02T07:32:15Z",
      "side": 1,
      "message": "check workload preflight-green",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "093e57df_a3817ec2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-02T12:20:06Z",
      "side": 1,
      "message": "Hi Tony,\n\nIt appears that the preflight team has renamed the files by adding the \"amd64\" prefix. Previously, we had:\n\npreflight_container_simple-demo-operator_kube-rbac-proxy_results-junit.xml\n\nNow, the logs show:\n\npreflight_container_simple-demo-operator_kube-rbac-proxy_amd64_results-junit.xml\n\nBefore merging this change, it would be better to update preflight-green as well. However, I\u0027m unsure how to provide backward compatibility in this case.\n\nAnother possible solution could be to ask the preflight team to remove the \"amd64\" prefix since the files are already in the folder called \"amd64\". Or, we could remove it within the app-agent on our side.\n\nLet me know your thoughts on this.\n\nThanks.",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cf830bf1_dc2dd420",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-08-02T15:19:07Z",
      "side": 1,
      "message": "\u003e It appears that the preflight team has renamed the files by adding the \"amd64\" prefix. Previously, we had:\n\u003e \n\u003e preflight_container_simple-demo-operator_kube-rbac-proxy_results-junit.xml\n\u003e \n\u003e Now, the logs show:\n\u003e \n\u003e preflight_container_simple-demo-operator_kube-rbac-proxy_amd64_results-junit.xml\n\u003e \n\u003e ...\n\u003e \n\u003e Another possible solution could be to ask the preflight team to remove the \"amd64\" prefix since the files are already in the folder called \"amd64\".\n\n\nThe examples shown in here seem like the ones we generate. I still see \"results-junit.xml\" as the output of the files from preflight. I don\u0027t seem to find files renamed. Could you share where did you see this?\n\n\n\u003e Before merging this change, it would be better to update preflight-green as well. \n\n\nCould you point me to what change needs to be done there? I\u0027ll take care of any modification needed in there.\n\n\n\u003e However, I\u0027m unsure how to provide backward compatibility in this case.\n\n\nCorrect, this change modifies the naming of the files. I only considered that the files are uploaded to DCI control server. Are they used in other place? If they do then I\u0027ll probably need to modify that other place as well.\n\n\nThanks for looking",
      "parentUuid": "093e57df_a3817ec2",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "aef233b2_9b20a5af",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-02T15:46:30Z",
      "side": 1,
      "message": "\u003e I still see \"results-junit.xml\" as the output of the files from preflight. I don\u0027t seem to find files renamed. Could you share where did you see this?\n\nOh I see, it\u0027s actually your change modifying the filename. \n\nWhen you replace \n\"{{ job_logs.path }}/{{ preflight_prefix }}_{{ item | basename }}\"\nwith \ndest: \"{{ job_logs.path }}/{{ preflight_prefix }}_{{ item.path | regex_replace(\u0027/\u0027, \u0027_\u0027) }}\"\n\nitem.path gives you a relative path amd64/results-junit.xml and then you convert it into amd64_results-junit.xml, here we see that in the logs: https://www.distributed-ci.io/jobs/7a988690-5551-48dd-b5d6-e91af49fe9d4/jobStates?sort\u003ddate\u0026task\u003d00aca17b-89fa-4246-946c-81c949d03670 \n\n\u0027src\u0027: \u0027/tmp/preflight_container_artifacts.8lx58bm3/amd64/results-junit.xml\u0027\n\"dest\": \"/tmp/dci_logs.fpx8g8kn/preflight_container_simple-demo-operator_kube-rbac-proxy_amd64_results-junit.xml\"\n\nCould we keep the original filename or there is a reason to append amd64 to it? It\u0027s currently used in a lot of places (here: https://softwarefactory-project.io/r/c/dci-openshift-app-agent/+/28784).\n\nThank you for working on it.",
      "parentUuid": "cf830bf1_dc2dd420",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "54933ba4_bfb9bf35",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-08-02T17:19:01Z",
      "side": 1,
      "message": "\u003e Could we keep the original filename or there is a reason to append amd64 to it? \n\nThe reason to include the architecture in them is to distinguish the results generated by preflight when a manifest list has more than one architecture.\n\n\u003e It\u0027s currently used in a lot of places (here: https://softwarefactory-project.io/r/c/dci-openshift-app-agent/+/28784).\n\nIn that change I see a reference to 3 files:\n- roles/preflight/tasks/test_preflight_check_container_one_image.yml\n- roles/preflight/tasks/tests_preflight_check_operator.yml\n- roles/pyxis/tasks/main.yml\n\nThis change is for the files generated by check container (the first one from the list) per architecture Are these same files used in the other files? The other seem to me used for operators and I see we are submitting containers here: https://softwarefactory-project.io/r/plugins/gitiles/dci-openshift-app-agent/+/refs/heads/master/roles/preflight/tasks/test_preflight_check_container_one_image.yml#72\n\nIf the files generated in the container check are used by the operator and pyxis then we will need to sync to discuss how to handle the new naming. Please let me know, thanks!",
      "parentUuid": "aef233b2_9b20a5af",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17ae5d3c_398a08fc",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 938
      },
      "writtenOn": "2023-08-03T07:43:49Z",
      "side": 1,
      "message": "\u003e The reason to include the architecture in them is to distinguish the results generated by preflight when a manifest list has more than one architecture.\n\n\u003e If the files generated in the container check are used by the operator and pyxis then we will need to sync to discuss how to handle the new naming.\n\nSure, let\u0027s have a sync. I was a bit confused by the previous change of Beto where we discussed the --amd64 flag, and I thought that preflight only allows testing for one architecture at most.\n\nIf that\u0027s not the case, and we could potentially generate many files, such as amd64_results.json and arm64_results.json at once, then we have to rework everything. Should we submit all these files in one certification project in the Connect UI, or should we use different projects for each architecture, etc.?\n\nI asked more questions to Brad, to better understand the idea: https://github.com/redhat-openshift-ecosystem/openshift-preflight/pull/997#issuecomment-1663450283",
      "parentUuid": "54933ba4_bfb9bf35",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b3380ea1_4314c530",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 667
      },
      "writtenOn": "2023-08-04T00:55:36Z",
      "side": 1,
      "message": "With the latest patchsets I\u0027ve included support to globbing into the verify-test. This should help with the multi arch files. PTAL and let me know what you think.",
      "parentUuid": "17ae5d3c_398a08fc",
      "revId": "f7e66780c11315fde9b0ce8fd847d3018c20f407",
      "serverId": "6c1dc8ef-8b94-40e4-bd83-c2359d45ecc0"
    }
  ]
}