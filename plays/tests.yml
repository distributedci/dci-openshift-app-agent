---

- block:

    - name: Run helm list
      command: "/usr/local/bin/helm -n {{ dci_openshift_app_ns }} list -o json -l name=instance"
      register: helm_list

    - name: Validate helm chart is deployed
      assert:
        that: "{{ helm_list.stdout | from_json }}[0].status == 'deployed'"
  when:
    - dci_chart_tgz_url is defined

- name: "Chart verifier tests"
  include_role:
    name: chart-verifier
  when:
    - do_charts_verifier|bool

- name: "cnf-cert tests"
  include_role:
    name: cnf-cert
    tasks_from: tests.yml
  vars:
    tnf_ns: "{{ dci_openshift_app_ns }}"
    tnf_tempdir:
      path: "{{ job_logs.path }}"
  when: do_cnf_cert|bool

- name: Preflight tests
  include_role:
    name: preflight
    tasks_from: tests.yml
  when: do_preflight_tests | bool

- name: Submit Preflight results to Pyxis
  include_role:
    name: pyxis
    tasks_from: submit.yml
  when:
    - do_preflight_tests | bool
    - submit_preflight_to_pyxis | bool

...
