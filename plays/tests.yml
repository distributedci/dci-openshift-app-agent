---

- name: "Chart verifier tests"
  include_role:
    name: chart-verifier
  when:
    - do_chart_verifier|bool

- name: "cnf-cert tests"
  include_role:
    name: cnf-cert
  when: do_cnf_cert|bool

# We need to do this at this point because we will not have
# claim.json file from CNF Cert Suite before this point.
- name: Retrieve Preflight operators from CNF Cert Suite claim.json output
  include_role:
    name: sync-cnf-cert-and-preflight
  when:
    - preflight_operators_to_certify is defined
    - sync_cnf_cert_and_preflight | bool

- name: Preflight container-only tests
  include_role:
    name: preflight
    tasks_from: main_standalone_containers_certification
  when: preflight_containers_to_certify is defined

- name: Preflight tests
  include_role:
    name: preflight
  when: preflight_operators_to_certify is defined

- name: Retrieve all CatalogSource present in openshift-marketplace Namespace
  community.kubernetes.k8s_info:
    api_version: operators.coreos.com/v1alpha1
    kind: CatalogSource
    namespace: openshift-marketplace
  register: cs

- name: Checking found CalalogSource with opcap
  include_role:
    name: opcap-tool
  vars:
    opcap_target_catalog_source: "{{ item }}"
    opcap_catalog_source_namespace: "openshift-marketplace"
    opcap_output_dir: "{{ job_logs.path }}"
  loop: "{{ cs | json_query('resources[*].metadata.name') }}"
  when: cs.resources|length > 2
...
