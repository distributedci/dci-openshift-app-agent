---

- name: post-run
  dci_job:
    id: "{{ job_id }}"
    status: "post-run"
  tags: [dci]

- name: "Run common logging process"
  include_tasks: "common_logging.yml"

- name: "cnf-cert post-run"
  include_role:
    name: cnf-cert
    tasks_from: post-run.yml
  when: do_cnf_cert|bool

- name: Delete namespace
  k8s:
    api_version: v1
    kind: Namespace
    name: "{{ dci_openshift_app_ns }}"
    state: absent
  when:
    - dci_teardown_on_success

- name: Save job info in the cluster
  block:
    - name: "Create DCI namespace"
      k8s:
        state: present
        definition:
          apiVersion: v1
          kind: Namespace
          metadata:
            name: openshift-dci

    - name: "Create DCI configmap"
      k8s:
        state: present
        definition:
          apiVersion: v1
          kind: ConfigMap
          metadata:
            name: "doaa-{{ ansible_date_time.epoch }}"
            namespace: openshift-dci
          data:
            job_info: "{{ job_info | to_json }}"
  when: dci_cluster_metadata | default(false) | bool

...
